import sched
import time
import requests
import json
from covid_data_handler import *
from DateTime import *


s = sched.scheduler(time.time, time.sleep)

""" Returns a list of the titles for each of the related news articles from the API

Parameters:
covid_terms (str): Contains terms that will get the news that I am looking for

Returns:
title (list): Contains all of the relevant titles from the news API
"""


def news_api_request(covid_terms: str = "Covid||COVID-19||coronavirus") -> list:
    base_url = "https://newsapi.org/v2/everything?"
    api_key = "e30de33ada8846cda564576240854c89"
    start = '2021-12-01'
    complete_url = base_url + 'q='+covid_terms + '&from='+start + '&sortBy=publishedAt' + '&language=en' + '&apiKey=' +\
        api_key
    response = requests.get(complete_url)

    news = response.json()['articles']

    title = []

    for i in range(0, len(news)):
        title.append(news[i].get('title'))

    return title


""" Returns a list of the titles for each of the related news articles from the API

Parameters:
covid_terms (str): Contains terms that will get the news that I am looking for

Returns:
content (list): Contains all of the relevant content from the news API
"""


def news_api_request_content(covid_terms: str = "Covid||COVID-19||coronavirus") -> list:
    base_url = "https://newsapi.org/v2/everything?"
    api_key = "e30de33ada8846cda564576240854c89"
    start = '2021-12-01'
    complete_url = base_url + 'q='+covid_terms + '&from='+start + '&sortBy=publishedAt' + '&language=en' + '&apiKey=' +\
        api_key
    response = requests.get(complete_url)

    news = response.json()['articles']

    content = []

    for i in range(0, len(news)):
        content.append(news[i].get('description'))

    return content


""" Function to update and get the latest news 

Parameters: 
update_interval (str): Time taken from the form 
update_name: Name of the function that will be called 

Returns:
None
"""


def update_news(update_interval: str, update_name):
    e1 = s.enter(update_interval, 1, update_name)
